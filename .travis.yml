matrix:
  include:
  # # Android job
  # - language: android
  #   sudo: required
  #   jdk: oraclejdk8
  #   android:
  #     env:
  #       global:
  #         - ANDROID_API_LEVEL=28
  #         - ANDROID_BUILD_TOOLS_VERSION=28.0.3
  #         - ANDROID_ABI=armeabi-v7a
        
  #     components:
  #       - tools
  #       - platform-tools
  #       - extra-android-m2repository

  #     licenses:
  #       - 'android-sdk-preview-license-52d11cd2'
  #       - 'android-sdk-license-.+'
  #       - 'google-gdk-license-.+'
      
  #     before_install:
  #       - touch $HOME/.android/repositories.cfg
  #       - yes | sdkmanager "platforms;android-28"
  #       - yes | sdkmanager "build-tools;28.0.3"
  #       - cd Android/GitViewer
  #       - gem update --system
  #       - gem install fastlane --quiet
  #       - gem install travis-conditions
  #       - bundle install
  #       - bundle update

  #     before_cache:
  #       - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  #       - rm -fr $HOME/.gradle/caches/*/plugin-resolution/

  #     cache:
  #         directories:
  #           - $HOME/.gradle/caches/
  #           - $HOME/.gradle/wrapper/
  #           - $HOME/.android/build-cache
      
  #     before_script:
  #         - cd $TRAVIS_BUILD_DIR/Android/GitViewer
  #         - chmod +x gradlew

  #     script:
  #         - ./gradlew dokka

  #     deploy:
  #         # Deploy a Staging version when Fabric/Staging tag is pushed
  #         - provider: script
  #           script: bundle exec fastlane deploy_staging
  #           on:
  #             branches:
  #               only:
  #                 - travisci
  #               tags: true
  #               conditions: "$TRAVIS_TAG =~ (?:Android\/Fabric\/Staging)"

  #         # Deploy a Production version when Fabric/Production tag is pushed
  #         - provider: script
  #           script: bundle exec fastlane deploy_production
  #           on:
  #             branches:
  #               only:
  #                 - travisci
  #               tags: true
  #               conditions: "$TRAVIS_TAG =~ (?:Android\/Fabric\/Production)"
                
  #         # Deploy a Production version to the Google Play Store
  #         - provider: script
  #           script: bundle exec fastlane deploy_play_store
  #           on:
  #             branches:
  #               only:
  #                 - travisci
  #             tags: true
  #             conditions: $TRAVIS_TAG =~ (?:Android\/GooglePlayStore)
      
        

  # # iOS Job
  # - language: swift
  #   sudo: required
  #   osx_image: xcode10.3
  #   ios:
  #     before_install:
  #       - echo -e "machine github.com\n  login $CI_GITHUB_TOKEN" >> ~/.netrc
  #       - cd iOS/GitViewer
  #       - gem update --system
  #       - gem install fastlane --quiet
  #       - gem install travis-conditions
  #       - gem install jazzy
  #       - bundle install
  #       - bundle update
      
  #     before_script:
  #       - cd $TRAVIS_BUILD_DIR/iOS/GitViewer
      
  #     script:
  #       - jazzy
      
  #     deploy:
  #       # Deploy a Staging version when Fabric/Staging tag is pushed
  #       - provider: script
  #         script: bundle exec fastlane deploy_staging
  #         on:
  #           branches:
  #             only:
  #               - travisci
  #             tags: true
  #             conditions: "$TRAVIS_TAG =~ (?:iOS\/Fabric\/Staging)"
        
  #       # Deploy a Production version when Fabric/Production tag is pushed
  #       - provider: script
  #         script: bundle exec fastlane deploy_production
  #         on:
  #           branches:
  #             only:
  #                 - travisci
  #             tags: true
  #             conditions: "$TRAVIS_TAG =~ (?:iOS\/Fabric\/Production)"
        
  #       # Deploy a Production version to the Apple App Store
  #       - provider: script
  #           script: bundle exec fastlane deploy_app_store
  #           on:
  #             branches:
  #               only:
  #                 - travisci
  #             tags: true
  #             conditions: $TRAVIS_TAG =~ (?:iOS\/Appstore)
  
  # Rails job
  - language: ruby
    rvm:
      - 2.5.5

    install: true
    sudo: required
  
    services:
      - docker
      - postgresql

    env:
      SELENIUM_DRIVER_URL: http://localhost:4444/wd/hub
      DATABASE_HOST: localhost
      RAILS_ENV: test
      BUNDLE_PATH: ~/bundle

    before_install:
      - docker pull selenium/standalone-chrome:3.5.3
      - docker run -d -p 4444:4444 --shm-size=2g selenium/standalone-chrome:3.5.3
      - cd rails
      - bundle check || bundle install

    script:
      - bundle exec rails db:create
      - bundle exec rails db:migrate
      - bundle exec rspec
      
    
    